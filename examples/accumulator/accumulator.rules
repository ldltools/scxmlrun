// Accumulator Forward

/*
// accumulator_mon1
protocol
init; 
day_close;
(day_open; day_close)*;
(knockout + terminate)
;;

// accumulator_mon4
protocol
init; 
day_close;
(_not_knockout; (_under_strike + _over_strike); day_open; day_close)*;
(_knockout; knockout + _not_knockout; (_under_strike + _over_strike); terminate)
;;
*/

rule

on init do {
    _data.KO_PRICE = _event.data.ko_price || 110;
    _data.STRIKE_PRICE = _event.data.strike_price || 90;
    _data.EXPIRY_DATE  = _event.data.expiry_date  || 3;
    //_data.SHARE_PER_DAY = _event.data.share_per_day || 1000;
    //_data.LEVERAGE = _event.data.leverage || 3;
    _data.cur_date = _event.data.cur_date || 1;
    _data.price = _event.data.price || 100;    
    //_data.bought_shares = _event.data.bought_shares || 0;
};

on day_close do {
    _data.price = _event.data.price;
};

on day_open do {
    _data.cur_date = _data.cur_date + 1;
};

on terminate do {
  if (_data.cur_date != EXPIRY_DATE)
    console.log ("** error: terminate");
};

on knockout do {
  if (_data.price < KO_PRICE)
    console.log ("** error: knockout");
};

